<!doctype html>
<head>
	<title>pollbc</title>
</head>

{{if .Departments}}
<form action="/">
	{{range $dep := .Departments}}
	<input type="checkbox" name="department" value="{{$dep}}">{{$dep}}
	{{end}}
	<br><input type="submit" value="Filter by department">
</form>
{{else}}
<form action="/">
	{{range $key, $place := .Places}}
	<input type="checkbox" name="placeID" value="{{$key}}">
	{{if $place.City}}
	{{$place.City}}
	{{else if $place.Arrondissement}}
	{{$place.Department}} {{$place.Arrondissement}}
	{{end}}
	{{end}}
	<br><input type="submit" value="Filter by place">
</form>
{{end}}

{{$places := .Places}}
{{$loc := .Location}}
<div>
	{{range .Announces}}
	<div>
		<hr>
		{{$fetched := .Fetched.In $loc}}
		{{.Date.Format "Monday January 2 15:04"}} (fetched at {{$fetched.Format "15:04"}})
		<br>
		<a href={{.ID}}>{{.Title}}</a> 
		<br>
		{{$place := index $places .PlaceID}}
		{{if $place.City}}
		<a href="/?placeID={{.PlaceID}}">{{$place.City}}</a> / <a href="/?department={{$place.Department}}">{{$place.Department}}</a>
		{{else if $place.Arrondissement}}
		<a href="/?department={{$place.Department}}">{{$place.Department}}</a> <a href="/?placeID={{.PlaceID}}">{{$place.Arrondissement}}</a>
		{{else}}
		<a href="/?department={{$place.Department}}">{{$place.Department}}</a>
		{{end}}
		{{if .Price}}<br><strong>{{.Price}}</strong>{{end}}
	</div>
	{{end}}
</div>
