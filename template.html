<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>pollbc</title>

		<link href="css/bootstrap.min.css" rel="stylesheet">
	</head>

	<body>
		<div class="navbar">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="/">pollbc</a>
				</div>
				<form class="navbar-form" action="/">
					{{if .PrintDpts}}
					<select class="form-control" name="departmentID">
						{{range $dep := .Departments}}
						<option value="{{$dep.ID}}">{{$dep.Name}}</option>
						{{end}}
					</select>
					{{else}}
					<select class="form-control" name="placeID">
						{{$dpt := index .Departments 0}}
						{{range $place := .Places}}
						{{if $place.City}}
						<option value="{{$place.ID}}">
						{{$place.City}}
						</option>
						{{else if $place.Arrondissement}}
						<option value="{{$place.ID}}">
						{{$dpt.Name}} {{$place.Arrondissement}}
						</option>
						{{end}}
						{{end}}
					</select>
					{{end}}
					<button class="btn btn-default" type="submit">Filter</button>
				</form>
			</div>
		</div>

		{{$placeMap := .PlaceMap}}
		{{$dptMap := .DptMap}}
		{{$loc := .Location}}
		<div class="container">
			{{range .Announces}}
			<div>
				<hr>
				{{$fetched := .Fetched.In $loc}}
				{{.Date.Format "Monday January 2 15:04"}} (fetched at {{$fetched.Format "15:04"}})
				<br>
				<a href={{.ID}}>{{.Title}}</a> 
				<br>
				{{$place := index $placeMap .PlaceID}}
				{{$dpt := index $dptMap $place.DepartmentID}}
				{{if $place.City}}
				<a href="/?placeID={{.PlaceID}}">{{$place.City}}</a> / <a href="/?departmentID={{$place.DepartmentID}}">{{$dpt.Name}}</a>
				{{else if $place.Arrondissement}}
				<a href="/?departmentID={{$place.DepartmentID}}">{{$dpt.Name}}</a> <a href="/?placeID={{.PlaceID}}">{{$place.Arrondissement}}</a>
				{{else}}
				<a href="/?departmentID={{$place.DepartmentID}}">{{$dpt.Name}}</a>
				{{end}}
				{{if .Price}}<br><strong>{{.Price}}</strong>{{end}}
			</div>
			{{end}}
		</div>

		<script src="js/jquery-1.11.3.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
	</body>
</html>
